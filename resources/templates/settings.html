<!DOCTYPE html>
<html lang="ar" dir="rtl">
    <head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>index</title>
	<link rel="icon" href="data:,">
	<link rel="stylesheet" href="/assets/css/index.css" type="text/css" media="screen" />
	<style>
	 .button{
	     @apply w-full border-gray-300 rounded-lg shadow-sm focus:border-accent focus:ring-accent;
	 }
	 .footer{
	     @apply sticky bottom-0;
	 }
	 /* class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 pl-5 border-2 border-black" */
	</style>
    </head>
    <body class="red-brown flex flex-col sm:w-full md:w-1/2 md:mx-auto min-h-screen relative">
	<header class="flex flex-row justify-between px-4 py-2 bg-secondery">
	    <span class="font-amiri text-lg">أطباق سُهيل</span>
	    <div class="block rounded-full sm:mx-0 sm:shrink-0">
		<a href="/dashboard">
		    {% if avatar-url|empty? %}
		    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
		    {% else %}
		    <img width="24" height="24" src="{{avatar-url}}"/>
		    {% endif %}
		</a>
	    </div>
	</header>
	<article class="grow flex-row gap-4">
	    <button class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-secondery text-black shadow hover:bg-primary/90 hover:text-white focus:bg-grass focus:text-white h-9 px-4 py-2 border-2 border-black" id="delete-btn">احذف الحساب</button>
	    <button class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-secondery shadow hover:bg-primary/90 focus:bg-grass focus-visible:text-white focus-visible:ring-accent2 hover:ring-1 h-11  px-8 py-2" id="signout-btn">خروج</button>
	</article>
	<footer class="flex flex-row justify-center w-full py-4 bg-accent2 text-white font-amiri font-semibold leading-3">
	    سليم خطيب
	</footer>
	<script>
	 let refresh_token=localStorage.getItem("refreshToken");
	 let signoutBtn=document.getElementById("signout-btn");
	 let deleteBtn=document.getElementById("delete-btn");
	 signoutBtn.addEventListener("click",(e)=>{
	     localStorage.removeItem("refreshToken");
	     var date=new Date();
	     date.setTime(date.getTime()-24*60*60*1000);
	     document.cookie="{{jwt-cookie-name}}"+"=;"+"expires="+date.toGMTString()+"; path=/;SameSite=Lax";
	     window.location="/";
	 });
	 deleteBtn.addEventListener("click",(e)=>{
	     fetch("/api/v1/account/delete",{"method": "DELETE"});
	 });
	 
	 function refreshToken(){
	     if(refresh_token!==null){
		 fetch("/token", {"method": "POST", "headers": {"content-type": "application/json"}, "body": JSON.stringify({"refresh-token": localStorage.getItem("refreshToken")}) }).then(a=>a.json()).then((v)=>{
		     if(v.status=="success"){
			 localStorage.setItem("refreshToken",v["refresh-token"]);
			 setTimeout(refreshToken,25000);
		     }else{
			 console.log(v["status"]);
		     }
		 });
	     }
	 }
	 refreshToken();
	</script>
	
    </body>
</html>
